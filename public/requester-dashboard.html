<!DOCTYPE html>
<html lang="en">

<head>
    <!-- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Requester Dashboard</title>

    <!-- ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå CSS ‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡πÑ‡∏ß‡πâ -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <video autoplay muted loop id="bg-video">
        <source src="7623013d2413b90d26bdfd90b5c485c3.mp4" type="video/mp4" />
      </video>
      <div class="top-bar">
        <div class="profile-dropdown">
          <img src="pf.jpg" class="profile-pic" onclick="toggleDropdown()" />
          <div class="dropdown-menu" id="dropdownMenu">
            <a href="#" onclick="logout()">Logout</a>
          </div>
        </div>
      </div>
      
    <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤ -->
    <div class="main-container">

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
        <div class="left-section">
            <h1 class="dashboard-title">Welcome, Requester! üìã</h1>

            <!-- ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
            <h2 class="sub-title">Submit Your Document</h2>
            <form id="uploadDocumentForm" class="form-group">
                <!-- ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
                <input type="text" id="title" placeholder="Enter document title" required>

                <!-- ID ‡∏Ç‡∏≠‡∏á requester (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà) -->
                <input type="hidden" id="requester_id">

                <!-- ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
                <input type="text" id="description" placeholder="Enter description" required>

                <!-- ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå -->
                <input type="file" id="documentFile" required>

                <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Approver ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à -->
                <label for="approver_id">Send to Approver:</label>
                <select id="approver_id" name="approverId" required>
                    <option value="">-- Select Approver --</option>
                </select>

                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° -->
                <button type="submit">Submit Document</button>
            </form>
        </div>

        <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤: ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà requester ‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á -->
        <div class="right-section">
            <h2 class="sub-title">üìÇ Your Submitted Documents</h2>
           <!--‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠--> 
            <input type="text" id="searchInput" placeholder="üîç Search by Title..." oninput="filterHistory()" class="search-box">
            <div id="myDocuments"></div>
        </div>

       <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° Edit ‡∏ó‡∏µ‡πà‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á Your Submitted Documents -->
<div class="edit-box edit-form-container hidden" id="editFormContainer">
  <h2 class="edit-title">üîóEdit Document</h2> 
  <form id="editForm" class="edit-form">
    <div class="form-group1">
      <input type="text" class="edit-input" id="edit_title" placeholder="Document Title" required />
    </div>
    <div class="form-group1">
      <input type="text" class="edit-input" id="edit_description" placeholder="Description" required />
    </div>
    <div class="form-group1">
      <input type="file" class="file-input" id="edit_document_file" />
    </div>
    <input type="hidden" id="edit_document_id" />
    <div class="form-group1 buttons">
      <button class="approve-btn" type="submit1"><strong>Save</strong></button>
      <button class="reject-btn" type="button" onclick="closeEditForm()"><strong>Cancle</strong></button>            
    </div>
  </form>
</div>
</div>


    <!-- ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ù‡∏±‡πà‡∏á client -->
    <script>
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î Submit Form
        document.getElementById('uploadDocumentForm').addEventListener('submit', async function (e) {
            e.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ reload ‡∏´‡∏ô‡πâ‡∏≤

            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å input ‡∏ï‡πà‡∏≤‡∏á‡πÜ
            const file = document.getElementById('documentFile').files[0];// ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏à‡∏≤‡∏Å input type="file"
            const title = document.getElementById('title').value;// ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            const requesterId = document.getElementById('requester_id').value;// ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á (‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å input hidden)
            const approverId = document.getElementById('approver_id').value;// ‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à (approver) ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å dropdown
            const description = document.getElementById('description').value;// ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£

            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend
            const formData = new FormData();
            formData.append('file', file);
            formData.append('title', title);
            formData.append('requesterId', requesterId);
            formData.append('approverId', approverId);
            formData.append('description', description);

           // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API upload ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏õ backend
            try {
                const response = await fetch('http://localhost:8000/api/upload', {
                    method: 'POST',
                    body: formData // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö multipart/form-data‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå
                });

                const result = await response.json();// ‡πÅ‡∏õ‡∏•‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô JSON


                if (response.ok) {// ‡∏ñ‡πâ‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ HTTP ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö OK (‡πÄ‡∏ä‡πà‡∏ô 200)
                    alert('Upload success');// ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    loadMyDocuments(); // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                } else {
                    alert('Upload error: ' + result.error);// ‡πÅ‡∏™‡∏î‡∏á error ‡∏ñ‡πâ‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                }
            } catch (error) {
                alert('Upload failed: ' + error.message);// ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö error ‡πÄ‡∏ä‡πà‡∏ô network ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
            }
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà requester ‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á
        async function loadMyDocuments() {
            const requesterId = localStorage.getItem('userId');// ‡∏î‡∏∂‡∏á user ID ‡∏Ç‡∏≠‡∏á requester ‡∏à‡∏≤‡∏Å localStorage ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ï‡∏≠‡∏ô login
            const container = document.getElementById('myDocuments');// div ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            container.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏≤

            try {
                const res = await fetch(`http://localhost:8000/api/requester-documents/${requesterId}`);// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÑ‡∏õ‡∏¢‡∏±‡∏á backend ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á userId
                const result = await res.json();

                if (result.success && Array.isArray(result.documents) && result.documents.length > 0) {
                     // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                    result.documents.forEach(doc => {
                        const div = document.createElement('div');// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        div.className = 'status-box'; // ‡πÉ‡∏ä‡πâ class ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î style

                        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
                        div.innerHTML = div.innerHTML = `
                             <div class="status-header ${doc.status}"><!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
                             <span class="doc-title">${doc.title}</span>
                             <span class="doc-status">${doc.status.toUpperCase()}</span>
                              </div>
                             <div class="status-details">
                             <p><strong>To Approver : </strong>${doc.approver}</p>
                             <p><strong>Description : </strong>${doc.description}</p>
                             <p><strong>Submitted At : </strong>${new Date(doc.created_at).toLocaleString()}</p>
                             <p><strong>Status : </strong><span class="${doc.status}">${doc.status}</span></p>
                            <p><strong>Comment : </strong>${doc.reason || '-'}</p> 
                             <p><strong>üìé <a href="${doc.file_path}" target="_blank">View File</a><strong></p>
                             </div>`;                 
 // ‡∏õ‡∏∏‡πà‡∏° Edit ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ pending
if (doc.status === 'pending') {
  div.innerHTML += `
    <button class="approve-btn" onclick="openEditForm(${doc.document_id}, \`${doc.title}\`, \`${doc.description}\`)"><strong>‚úèÔ∏è Edit</strong></button>
  `;
}
// ‡∏õ‡∏∏‡πà‡∏° Delete ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏•‡∏≠‡∏î‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
div.innerHTML += `
  <button class="reject-btn" onclick="deleteDocument(${doc.document_id})"><strong>üóëÔ∏è Delete</strong></button>
`;

                        container.appendChild(div);// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô DOM
                    });
                    
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏•‡∏¢
                    container.innerHTML = `<p style="color: #888; font-style: italic; text-align: left; padding: 20px;">No documents submitted yet.</p>`;
                }
            } catch (err) {
                container.textContent = 'Failed to load documents.'; // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Approver ‡∏à‡∏≤‡∏Å backend
        async function loadApprovers() {
            try {
                const res = await fetch('http://localhost:8000/api/approvers'); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Approver
                const data = await res.json();

                const select = document.getElementById('approver_id');// select dropdown ‡∏Ç‡∏≠‡∏á Approver
                select.innerHTML = '<option value="">-- Select Approver --</option>';// ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï options


                data.forEach(user => {
                    const option = document.createElement('option');// ‡∏™‡∏£‡πâ‡∏≤‡∏á <option> ‡πÉ‡∏´‡∏°‡πà
                    option.value = user.id;
                    option.textContent = user.username;
                    select.appendChild(option); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤ dropdown
                });
            } catch (error) {
                alert('Failed to load approvers.'); // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            }
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à
        window.addEventListener('DOMContentLoaded', () => {
            const userId = localStorage.getItem('userId'); // ‡∏î‡∏∂‡∏á user id ‡∏à‡∏≤‡∏Å localStorage
            document.getElementById('requester_id').value = userId; // ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ requesterId ‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            loadApprovers(); // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ approver
            //loadMyDocuments();// ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏á requester
        });


// ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô dropdown ‡∏Ç‡∏≠‡∏á‡πÄ‡∏°‡∏ô‡∏π‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå        
 function toggleDropdown() {
    const menu = document.getElementById("dropdownMenu");
    menu.style.display = menu.style.display === "flex" ? "none" : "flex";// toggle ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î dropdown
  }
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô logout
  function logout() {
    localStorage.clear();// ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô localStorage (‡πÄ‡∏ä‡πà‡∏ô userId, role)
    alert("Logged out!");// ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    window.location.href = "index.html"; // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login

  }

  // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å dropdown ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î
  window.addEventListener('click', function(e) {
    if (!e.target.closest('.profile-dropdown')) {
      document.getElementById("dropdownMenu").style.display = "none";// ‡∏õ‡∏¥‡∏î dropdown ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å
    }
  });    


// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠
  function filterHistory() {
  const input = document.getElementById('searchInput').value.toLowerCase();// ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
  const boxes = document.querySelectorAll('#myDocuments .status-box'); // ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

  boxes.forEach(box => {
    const title = box.querySelector('.doc-title').textContent.toLowerCase();// ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
    if (title.includes(input)) {
      box.style.display = 'block';// ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠
    } else {
      box.style.display = 'none';// ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á
    }
  });
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô openEditForm ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL
function openEditForm(docId, title, description) {
  // ‡πÄ‡∏û‡∏¥‡πà‡∏° document ID ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô URL ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ History API
  window.history.pushState({}, '', `?edit=${docId}`);
  
  document.getElementById('editFormContainer').classList.remove('hidden');
  document.getElementById('edit_document_id').value = docId;
  document.getElementById('edit_title').value = title;
  document.getElementById('edit_description').value = description;
}

// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô closeEditForm ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö ID ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å URL
function closeEditForm() {
  // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á URL ‡πÄ‡∏î‡∏¥‡∏°
  window.history.pushState({}, '', window.location.pathname);
  
  document.getElementById('editFormContainer').classList.add('hidden');
}

// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç event listener ‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
document.getElementById('editForm').addEventListener('submit', async function (e) {
  e.preventDefault();
  const docId = document.getElementById('edit_document_id').value;
  const title = document.getElementById('edit_title').value;
  const description = document.getElementById('edit_description').value;
  const file = document.getElementById('edit_document_file').files[0];

  const formData = new FormData();
  formData.append('title', title);
  formData.append('description', description);
  if (file) formData.append('file', file);

  try {
    const response = await fetch(`http://localhost:8000/api/documents/${docId}`, {
      method: 'PUT',
      body: formData,
    });

    const result = await response.json();
    if (result.success) {
      alert('Document updated!');
      closeEditForm(); // ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô closeEditForm ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏≠‡∏≤ ID ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å URL)
      loadMyDocuments(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
    } else {
      alert('Update failed: ' + result.error);
    }
  } catch (err) {
    alert('Error: ' + err.message);
  }
});

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
function checkUrlForEdit() {
  const urlParams = new URLSearchParams(window.location.search);
  const editDocId = urlParams.get('edit');
  
  if (editDocId) {
    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ parameter edit ‡πÉ‡∏ô URL ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    fetchDocumentAndOpenForm(editDocId);
  }
}

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ï‡∏≤‡∏° ID ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
async function fetchDocumentAndOpenForm(docId) {
  try {
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° API endpoint ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô backend ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ï‡∏≤‡∏° ID
    const response = await fetch(`http://localhost:8000/api/documents/${docId}`);
    const result = await response.json();
    
    if (result.success) {
      openEditForm(docId, result.document.title, result.document.description);
    } else {
      alert('Cannot find document to edit');
      window.history.pushState({}, '', window.location.pathname); // ‡∏•‡∏ö parameter ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å URL
    }
  } catch (err) {
    alert('Error loading document: ' + err.message);
    window.history.pushState({}, '', window.location.pathname); // ‡∏•‡∏ö parameter ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å URL
  }
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à
window.addEventListener('DOMContentLoaded', () => {
  const userId = localStorage.getItem('userId'); // ‡∏î‡∏∂‡∏á user id ‡∏à‡∏≤‡∏Å localStorage
  document.getElementById('requester_id').value = userId; // ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤ requesterId ‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  loadApprovers(); // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ approver
  loadMyDocuments(); // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏Ç‡∏≠‡∏á requester
  checkUrlForEdit(); // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏ ID ‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
});

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
async function deleteDocument(docId) {
  if (confirm('Are you sure you want to delete this document?')) {
    try {
      const res = await fetch(`http://localhost:8000/api/documents/${docId}`, {
        method: 'DELETE'
      });
      const result = await res.json();
      if (result.success) {
        alert('Document deleted!');
        loadMyDocuments(); // ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡∏´‡∏•‡∏±‡∏á‡∏•‡∏ö
      } else {
        alert('Delete failed');
      }
    } catch (err) {
      alert('Error deleting: ' + err.message);
    }
  }
}

    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
</body>

</html>