<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Approver Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="dashboard-container">
    <h1 class="dashboard-title">Welcome, Approver</h1>
    <div id="pendingDocs"></div>
  </div>

  <script>
    /*const approverId = localStorage.getItem('userId'); // ดึง user id จาก localStorage

    async function loadPendingDocs() {
        const res = await fetch(`http://localhost:8000/api/pending-docs?approverId=${approverId}`);
        const docs = await res.json();

        const container = document.getElementById('pendingDocs');
        container.innerHTML = '';

        docs.forEach(doc => {
            const div = document.createElement('div');
            div.classList.add('status');

            div.innerHTML = `
                <p><strong>${doc.title}</strong></p>
                <p>From: ${doc.requester}</p>
                <p><a href="${doc.file_path}" target="_blank">Download File</a></p>
                <button onclick="updateStatus(${doc.document_id}, 'approved')">Approve</button>
                <button onclick="updateStatus(${doc.document_id}, 'rejected')">Reject</button>
            `;
            container.appendChild(div);
        });
    }

    async function updateStatus(docId, status) {
        const res = await fetch('http://localhost:8000/api/update-status', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ documentId: docId, status })
        });

        const result = await res.json();
        if (result.success) {
            alert(`Document ${status}!`);
            loadPendingDocs(); // โหลดใหม่
        } else {
            alert('Error: ' + result.error);
        }
    }

    loadPendingDocs();*/

    const approverId = localStorage.getItem('userId');

if (!approverId) {
    alert("ยังไม่ได้ login! กำลังพาไปหน้า login...");
    window.location.href = 'index.html'; 
} else {
    loadPendingDocs();
}

async function loadPendingDocs() {
    try {
        const res = await fetch(`http://localhost:8000/api/pending-docs?approverId=${approverId}`);
        const docs = await res.json();

        // ✅ เช็คว่า docs เป็น array ก่อนค่อย .forEach
        if (!Array.isArray(docs)) {
            console.error('Unexpected response:', docs);
            return;
        }

        const container = document.getElementById('pendingDocs');
        container.innerHTML = '';

        docs.forEach(doc => {
            const div = document.createElement('div');
            div.classList.add('status');

            div.innerHTML = `
                <p><strong>${doc.title}</strong></p>
                <p>From: ${doc.requester}</p>
                <p><a href="${doc.file_path}" target="_blank">Download File</a></p>
                <button onclick="updateStatus(${doc.document_id}, 'approved')">Approve</button>
                <button onclick="updateStatus(${doc.document_id}, 'rejected')">Reject</button>
            `;
            container.appendChild(div);
        });
    } catch (err) {
        console.error('Error loading pending documents:', err);
    }
}

async function updateStatus(docId, status) {
    const res = await fetch('http://localhost:8000/api/update-status', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ documentId: docId, status })
    });

    const result = await res.json();
    if (result.success) {
        alert(`Document ${status}!`);
        loadPendingDocs();
    } else {
        alert('Error: ' + result.error);
    }
}
  </script>
</body>
</html>
