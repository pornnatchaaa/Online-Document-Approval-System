<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Online Document Approval System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="style-web.css">
</head>
<body>
   <!-- à¸§à¸´à¸”à¸µà¹‚à¸­à¸žà¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡ (background video) -->
    <video autoplay muted loop id="bg-video">
        <source src="7623013d2413b90d26bdfd90b5c485c3.mp4" type="video/mp4" />
      </video>
  <div class="auth-container">
    <h1 class="main-title"><strong>Welcome to Document Approval System ðŸ“‡</strong></h1>

    <!-- Register Form -->
    <div id="registerForm" class="form-box">
      <h2 class="sub-title"><strong>Register</strong></h2>
       <!-- à¸Ÿà¸­à¸£à¹Œà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ -->
      <form id="registerFormData">
        <input type="text" id="username" placeholder="Username" required>
        <input type="password" id="password" placeholder="Password" required>
        <input type="email" id="email" placeholder="Email" required>
         <!-- à¹€à¸¥à¸·à¸­à¸à¸šà¸—à¸šà¸²à¸—à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ -->
        <select id="role" required>
          <option value="" disabled selected>Select Position</option>
          <option value="requester">Requester</option>
          <option value="approver">Approver</option>
        </select>
         <!-- à¸›à¸¸à¹ˆà¸¡à¸¥à¸‡à¸—à¸°à¹€à¸šà¸µà¸¢à¸™ -->
        <button type="submit">Register</button>
      </form>
      <!-- à¸¥à¸´à¸‡à¸à¹Œà¸ªà¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸² login -->
      <p class="form-toggle">Already have an account? <a href="javascript:void(0);" onclick="showLoginForm()">Login here</a></p>
    </div>

    <!-- Login Form -->
       <!-- à¸Ÿà¸­à¸£à¹Œà¸¡à¸¥à¹‡à¸­à¸à¸­à¸´à¸™ (à¸‹à¹ˆà¸­à¸™à¸•à¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸”à¹‰à¸§à¸¢ class hidden) -->
    <div id="loginForm" class="form-box hidden">
      <h2 class="sub-title"><strong>Login</strong></h2>
      <form id="loginFormData">
        <input type="text" id="loginUsername" placeholder="Username" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button type="submit">Login</button>
      </form>
         <!-- à¸¥à¸´à¸‡à¸à¹Œà¸ªà¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸² register -->
      <p class="form-toggle">Donâ€™t have an account? <a href="javascript:void(0);" onclick="showRegisterForm()">Register here</a></p>
    </div>
  </div>

  <script>
     // à¸ªà¸¥à¸±à¸šà¹à¸ªà¸”à¸‡à¸Ÿà¸­à¸£à¹Œà¸¡ login
    function showLoginForm() {
      document.getElementById('registerForm').classList.add('hidden');
      document.getElementById('loginForm').classList.remove('hidden');
    }
    // à¸ªà¸¥à¸±à¸šà¹à¸ªà¸”à¸‡à¸Ÿà¸­à¸£à¹Œà¸¡ register
    function showRegisterForm() {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('registerForm').classList.remove('hidden');
    }

    // à¸à¸”à¸›à¸¸à¹ˆà¸¡ Register à¹à¸¥à¹‰à¸§à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸› backend
    document.getElementById('registerFormData').addEventListener('submit', async function(e) {
      e.preventDefault();// à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸à¸²à¸£ reload à¸«à¸™à¹‰à¸²
      // à¸”à¸¶à¸‡à¸„à¹ˆà¸²à¸ˆà¸²à¸ input
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const email = document.getElementById('email').value;
      const role = document.getElementById('role').value;
      // à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸›à¸¢à¸±à¸‡ API register
      try {
        const response = await axios.post('http://localhost:8000/api/register', {
          username, password, email, role
        });
        // à¸–à¹‰à¸²à¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¹ƒà¸«à¹‰à¸ªà¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸² Login
        if (response.data.success) {
          alert('Registration successful!');
          showLoginForm();
        } else {
          alert('Register failed: ' + (response.data.error || 'Unknown error'));
        }
      } catch (err) {
        alert('Error: ' + err.message);
      }
    });

    // à¸à¸”à¸›à¸¸à¹ˆà¸¡ Login à¹à¸¥à¹‰à¸§à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸› backend
    document.getElementById('loginFormData').addEventListener('submit', async function(e) {
      e.preventDefault();
      // à¸”à¸¶à¸‡à¸„à¹ˆà¸²à¸ˆà¸²à¸à¸Šà¹ˆà¸­à¸‡ login
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;

      try {
        const response = await axios.post('http://localhost:8000/api/login', {
          username, password
        });
       // à¸–à¹‰à¸² login à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸‡ localStorage
        if (response.data.success) {
          localStorage.setItem('token', response.data.token); //à¹€à¸à¹‡à¸š token à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸¸à¸•à¸±à¸§à¸•à¸™à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰
          //token = à¸£à¸«à¸±à¸ªà¸¥à¸±à¸šà¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ à¸—à¸µà¹ˆà¸šà¸­à¸à¸§à¹ˆà¸² â€œà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸„à¸™à¸™à¸µà¹‰ login à¹à¸¥à¹‰à¸§à¸™à¸°â€à¸¡à¸±à¸™à¸ˆà¸°à¸–à¸¹à¸à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸šà¸¡à¸²à¸ˆà¸²à¸ backend à¸•à¸­à¸™à¸—à¸µà¹ˆ login à¸ªà¸³à¹€à¸£à¹‡à¸ˆ
          localStorage.setItem('userId', response.data.userId);
          localStorage.setItem('userRole', response.data.role);
          alert('Login successful!')
          setTimeout(() => {
           // à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸«à¸™à¹‰à¸²à¹„à¸›à¸¢à¸±à¸‡ dashboard à¸•à¸²à¸¡ role
          if (response.data.role === 'requester') {
            window.location.href = 'requester-dashboard.html';
          } else if (response.data.role === 'approver') {
            window.location.href = 'approver-dashboard.html';
          } /*else {
            window.location.href = 'dashboard.html';
          }*/
        }, 300);
        } else {
          alert('Login failed: ' + (response.data.error || 'Unknown error'));
        }
      } catch (err) {
        alert('Username or password is incorrect.');
      }
    });
  </script>
</body>
</html>
